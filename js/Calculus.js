if("undefined"!=typeof module&&void 0===nerdamer){var nerdamer=require("./nerdamer.core.js");require("./Algebra.js")}!function(){"use strict";var e=nerdamer.getCore(),i=e.PARSER,r=e.Frac,n=e.Settings,t=e.Utils.isSymbol,a=e.groups.FN,s=e.Symbol,o=e.Utils.text,l=e.Utils.inBrackets,p=e.Utils.isInt,u=e.Utils.format,c=e.Utils.even,f=e.Utils.evaluate,g=e.groups.N,m=e.groups.S,w=(a=e.groups.FN,e.groups.PL),d=e.groups.CP,v=e.groups.CB,y=e.groups.EX,b=e.groups.P,h=n.LOG,L="abs",_="sqrt",U="sin",k="cos",q="tan",S="sec",x="csc",T="cot",C="asin",N="acos",I="atan",A="asec",E="acsc",M="acot",O="sinh",F="cosh",R="tanh",G="csch",D="sech",V="coth",P="asech",B="acsch",H="acoth";function Q(e){this.message=e||""}Q.prototype=new Error,s.prototype.hasIntegral=function(){return this.containsFunction("integrate")},s.prototype.fnTransform=function(){if(this.group!==a)return this;var e,r=this.args[0],n=new s(this.multiplier),t=this.clone().toUnitMultiplier();if(this.isLinear())switch(this.fname){case O:e=i.parse(u("(e^({0})-e^(-({0})))/2",r));break;case F:e=i.parse(u("(e^({0})+e^(-({0})))/2",r));break;case R:e=i.parse(u("(e^({0})-e^(-({0})))/(e^({0})+e^(-({0})))",r));break;case q:e=i.parse(u("sin({0})/cos({0})",r));break;case x:e=i.parse(u("1/sin({0})",r));break;case S:e=i.parse(u("1/cos({0})",r));break;default:e=t}else if(this.power.equals(2))switch(this.fname){case U:e=i.parse(u("1/2-cos(2*({0}))/2",r));break;case k:e=i.parse(u("1/2+cos(2*({0}))/2",r));break;case q:e=i.parse(u("sin({0})^2/cos({0})^2",r));break;case F:e=i.parse(u("1/2+cosh(2*({0}))/2",r));break;case O:e=i.parse(u("-1/2+cosh(2*({0}))/2",r));break;case R:e=i.parse(u("(1+cosh(2*({0})))/(-1+cosh(2*({0})))",r));break;case S:e=i.parse(u("(1-cos(2*({0})))/(1+cos(2*({0})))+1",r));break;default:e=t}else e=this.fname===S?i.parse(u("1/cos({0})^({1})",this.args[0],this.power)):this.fname===x?i.parse(u("1/sin({0})^({1})",this.args[0],this.power)):this.fname===q?this.power.lessThan(0)?i.parse(u("cos({0})^(-({1}))/sin({0})^({1})",this.args[0],this.power.negate())):i.parse(u("sin({0})^({1})/cos({0})^({1})",this.args[0],this.power)):this.fname===U&&this.power.lessThan(0)?i.parse(u("csc({0})^(-({1}))",this.args[0],this.power.negate())):this.fname===k&&this.power.lessThan(0)?i.parse(u("sec({0})^(-({1}))",this.args[0],this.power.negate())):this.fname===U&&this.power.equals(3)?i.parse(u("(3*sin({0})-sin(3*({0})))/4",this.args[0])):this.fname===k&&this.power.equals(3)?i.parse(u("(cos(3*({0}))+3*cos({0}))/4",this.args[0])):t;return i.multiply(e,n)},e.Expression.prototype.hasIntegral=function(){return this.symbol.hasIntegral()},e.Utils.toCommonDenominator=function(r){if(r.isComposite()&&r.isLinear()){var n=new s(r.multiplier),t=new s(1),a=new s(0);return r.each(function(e){t=i.multiply(t,e.getDenom())},!0),r.each(function(e){var r=e.getNum(),n=e.getDenom(),s=i.multiply(r,i.divide(t.clone(),n));a=i.add(a,s)}),i.multiply(n,e.Algebra.divide(i.expand(a),i.expand(t)))}return r},e.Utils.in_inverse_trig=function(e){return-1!==[C,N,I,E,A,M].indexOf(e)},e.Utils.in_trig=function(e){return-1!==[k,U,q,S,x,T].indexOf(e)},e.Utils.in_htrig=function(e){return-1!==[O,F,R,B,P,H].indexOf(e)};var j=e.Utils.all_functions=function(e){for(var i=0,r=e.length;i<r;i++)if(e[i].group!==a)return!1;return!0},X=e.Utils.cosAsinBtranform=function(e,r){var n,t;return n=e.args[0],t=r.args[0],i.parse(u("(sin(({0})+({1}))-sin(({0})-({1})))/2",n,t))},Z=e.Utils.cosAsinAtranform=function(e,r){return 1!==Number(r.power)?i.multiply(e,r):(n=e.args[0],i.parse(u("(sin(2*({0})))/2",n)));var n},z=e.Utils.cosAsinBtranform=function(e,r){var n,t;return n=e.args[0],t=r.args[0],i.parse(u("(cos(({0})+({1}))-cos(({0})-({1})))/2",n,t))},J=e.Utils.trigTransform=function(e){for(var r,n,t={},o=new s(1),l=0,p=e.length;l<p;l++)if((r=e[l]).group===a){var u=r.fname;u===k&&t[U]?(n=t[U].args[0].toString()!==r.args[0].toString()?X(r,t[U]):Z(r,t[U]),delete t[U],o=i.multiply(o,n)):u===U&&t[k]?(n=t[k].args[0].toString()!==r.args[0].toString()?X(r,t[k]):Z(r,t[k]),delete t[k],o=i.multiply(o,n)):u===U&&t[U]?(t[U].args[0].toString()!==r.args[0].toString()?(n=z(r,t[U]),delete t[U]):(n=i.multiply(r,t[U]),delete t[U]),o=n):t[u]=r}else o=i.multiply(o,r);for(var c in t)o=i.multiply(o,t[c]);return o};e.Settings.integration_depth=10;var K=e.Calculus={version:"1.4.5",sum:function(r,n,t,a){if(n.group!==e.groups.S)throw new e.exceptions.NerdamerTypeError("Index must be symbol. "+o(n)+" provided");var l;if(n=n.value,e.Utils.isNumericSymbol(t)&&e.Utils.isNumericSymbol(a)){var p=a-t<200?"":"PARSE2NUMBER";t=Number(t),a=Number(a),l=e.Utils.block(p,function(){for(var o=r.text(),l={"~":!0},p=new e.Symbol(0),u=t;u<=a;u++){l[n]=new s(u);var c=i.parse(o,l);p=i.add(p,c)}return p})}else l=i.symfunction("sum",arguments);return l},product:function(r,n,t,a){if(n.group!==e.groups.S)throw new e.exceptions.NerdamerTypeError("Index must be symbol. "+o(n)+" provided");var l;if(n=n.value,e.Utils.isNumericSymbol(t)&&e.Utils.isNumericSymbol(a)){var p=a-t<200?"":"PARSE2NUMBER";l=e.Utils.block(p,function(){t=Number(t),a=Number(a.multiplier);for(var o=r.text(),l={},p=new e.Symbol(1),u=t;u<=a;u++)l[n]=new s(u),p=i.multiply(p,i.parse(o,l));return p})}else l=i.symfunction("product",arguments);return l},diff:function(p,u,c){if(e.Utils.isVector(p)){var f=new e.Vector([]);return p.each(function(e){f.elements.push(K.diff(e,u))}),f}var O=t(u)?u.text():u;if(c=t(c)?c.multiplier:c||1,void 0===O&&(O=e.Utils.variables(p)[0]),p.group===a&&p.fname===_){var F=p.args[0],Q=p.power.clone();F.group===g&&F.group===b||(F.power=t(F.power)?i.multiply(F.power,i.multiply(new s(.5)),Q):F.power.multiply(new r(.5)).multiply(Q),F.multiplier=F.multiplier.multiply(p.multiplier)),p=F}if(p.group!==a||t(p.power))p=z(p);else{var j=z(i.parse(p)),X=K.diff(p.args[0].clone(),O);p=i.multiply(j,X)}return c>1&&(c--,p=K.diff(p,u,c)),p;function Z(e){return(e.value===O||e.contains(O,!0))&&(e.multiplier=e.multiplier.multiply(e.power),e.power=e.power.subtract(new r(1)),e.power.equals(0)&&(e=s(e.multiplier))),e}function z(e){var p,c,f=e.group;if(f===g||f===m&&e.value!==O||f===b)e=s(0);else if(f===m)e=Z(e);else{if(f===v){var _=e.multiplier.clone();e.toUnitMultiplier();var F=i.multiply(function(e){for(var r=e.collectSymbols(),n=new s(0),t=r.length,a=0;a<t;a++){for(var o=K.diff(r[a].clone(),O),l=0;l<t;l++)a!==l&&(o=i.multiply(o,r[l].clone()));n=i.add(n,o)}return n}(e),Z(e));return F.multiplier=F.multiplier.multiply(_),F}if(f===a&&e.power.equals(1))switch(e.fname){case h:c=e.clone(),(e=e.args[0].clone()).power=e.power.negate(),e.multiplier=c.multiplier.divide(e.multiplier);break;case k:e.fname=U,e.multiplier.negate();break;case U:e.fname=k;break;case q:e.fname=S,e.power=new r(2);break;case S:e=J(e,q);break;case x:e=J(e,"-cot");break;case T:e.fname=x,e.multiplier.negate(),e.power=new r(2);break;case C:e=i.parse("(sqrt(1-("+o(e.args[0])+")^2))^(-1)");break;case N:e=i.parse("-(sqrt(1-("+o(e.args[0])+")^2))^(-1)");break;case I:e=i.parse("(1+("+o(e.args[0])+")^2)^(-1)");break;case L:_=e.multiplier.clone(),e.toUnitMultiplier(),(p=e.args[0].clone()).toUnitMultiplier(),(e=i.parse(l(o(e.args[0]))+"/abs"+l(o(p)))).multiplier=_;break;case"parens":e=s(1);break;case"cosh":e.fname="sinh";break;case"sinh":e.fname="cosh";break;case R:e.fname=D,e.power=new r(2);break;case D:e=J(e,"-tanh");break;case G:var Q=String(e.args[0]);return i.parse("-coth("+Q+")*csch("+Q+")");case V:Q=String(e.args[0]);return i.parse("-csch("+Q+")^2");case"asinh":e=i.parse("(sqrt(1+("+o(e.args[0])+")^2))^(-1)");break;case"acosh":e=i.parse("(sqrt(-1+("+o(e.args[0])+")^2))^(-1)");break;case"atanh":e=i.parse("(1-("+o(e.args[0])+")^2)^(-1)");break;case P:Q=String(e.args[0]);e=i.parse("-1/(sqrt(1/("+Q+")^2-1)*("+Q+")^2)");break;case H:e=i.parse("-1/(("+e.args[0]+")^2-1)");break;case B:Q=String(e.args[0]);e=i.parse("-1/(sqrt(1/("+Q+")^2+1)*("+Q+")^2)");break;case A:Q=String(e.args[0]);e=i.parse("1/(sqrt(1-1/("+Q+")^2)*("+Q+")^2)");break;case E:Q=String(e.args[0]);e=i.parse("-1/(sqrt(1-1/("+Q+")^2)*("+Q+")^2)");break;case M:e=i.parse("-1/(("+e.args[0]+")^2+1)");break;case"S":Q=String(e.args[0]);e=i.parse("sin((pi*("+Q+")^2)/2)");break;case"C":Q=String(e.args[0]);e=i.parse("cos((pi*("+Q+")^2)/2)");break;case"Si":Q=e.args[0];e=i.parse("sin("+Q+")/("+Q+")");break;case"Shi":Q=e.args[0];e=i.parse("sinh("+Q+")/("+Q+")");break;case"Ci":Q=e.args[0];e=i.parse("cos("+Q+")/("+Q+")");break;case"Chi":Q=e.args[0];e=i.parse("cosh("+Q+")/("+Q+")");break;case"Ei":Q=e.args[0];e=i.parse("e^("+Q+")/("+Q+")");break;case"Li":Q=e.args[0];e=i.parse("1/"+n.LOG+"("+Q+")");break;case"erf":e=i.parse("(2*e^(-("+e.args[0]+")^2))/sqrt(pi)");break;case"atan2":var j=String(e.args[0]),X=String(e.args[1]);e=i.parse("("+X+")/(("+X+")^2+("+j+")^2)");break;case"sign":e=new s(0);break;case n.LOG10:e=i.parse("1/(("+e.args[0]+")*"+n.LOG+"(10))");break;default:e=i.symfunction("diff",[e,u])}else if(f===y||f===a&&t(e.power)){var W;W=f===y?e.value:f===a&&e.contains(O)?e.fname+l(o(e.args[0])):e.value+l(o(e.args[0])),i.multiply(i.parse(h+l(W)),e.power.clone()),p=K.diff(i.multiply(i.parse(h+l(W)),e.power.clone()),O),e=i.multiply(e,p)}else if(f!==a||e.power.equals(1)){if(f===d||f===w){var Y=new s(0);for(var $ in e.symbols)Y=i.add(Y,K.diff(e.symbols[$].clone(),O));e=i.multiply(Z(e.clone()),Y)}}else(p=e.clone()).toLinear(),p.toUnitMultiplier(),e=i.multiply(Z(e.clone()),z(p))}return e.updateHash(),e}function J(e,r,n){return i.multiply(e,i.parse(r+l(n||o(e.args[0]))))}},integration:{u_substitution:function(r,n){function t(e,r,t){var a=t?t(e,r):i.divide(e.clone(),K.diff(r,n));return a.contains(n,!0)?null:a}function o(e,r){var n=K.integrate(i.symfunction(e,[new s(g)]),g,0);return(n=n.sub(new s(g),r)).updateHash(),n}var l,p=r[0].clone(),u=r[1].clone(),c=p.group,f=u.group,g="__u__";if(c===a&&f!==a){if(l=t(u,(m=p.args[0]).clone()))return i.multiply(l,o(p.fname,m));if(l=t(u,p))return K.integration.poly_integrate(p)}else if(f===a&&c!==a){var m;if(l=t(p,(m=u.args[0]).clone()))return i.multiply(l,o(u.fname,m))}else if(c===a&&f===a){if(l=t(p.clone(),u.clone()))return i.multiply(K.integration.poly_integrate(u),l);if(l=t(u.clone(),p.clone()))return i.multiply(K.integration.poly_integrate(u),l)}else{if(c===y&&f!==y){if(!(l=t(u,(_=p.power).clone()))){var w=K.integration.decompose_arg(_.clone(),n),d=K.diff(w[2].clone(),n),v=K.integration.decompose_arg(d.clone(),n);if(i.multiply(w[1],v[1]).power.equals(u.power)){var b=i.divide(w[0].clone(),v[0].clone()),h=i.multiply(b.clone(),i.pow(new s(p.value),i.multiply(w[0],new s(g))));return h=i.multiply(h,new s(g)),K.integration.by_parts(h,g,0,{}).sub(g,w[1].clone())}}var L=K.integrate(p.sub(_.clone(),new s(g)),g,0);return i.multiply(L.sub(new s(g),_),l)}if(f===y&&c!==y){var _;l=t(p,(_=u.power).clone());L=K.integrate(u.sub(_,new s(g)),g,0);return i.multiply(L.sub(new s(g),_),l)}if(p.isComposite()||u.isComposite()){var U=function(r,t){var a=e.Algebra.Factor.factor(r),s=e.Algebra.Factor.factor(K.diff(t,n));return i.divide(a,s)},k=p.isComposite()?p.clone().toLinear():p.clone(),q=u.isComposite()?u.clone().toLinear():u.clone();if(l=t(k.clone(),q.clone(),U))return i.multiply(K.integration.poly_integrate(u),l);if(l=t(q.clone(),k.clone(),U))return i.multiply(K.integration.poly_integrate(p),l)}}},poly_integrate:function(e){var r=e.power.toString(),n=e.multiplier.toDecimal(),t=e.toUnitMultiplier().toLinear();return-1===Number(r)?i.multiply(new s(n),i.symfunction(h,[t])):i.parse(u("({0})*({1})^(({2})+1)/(({2})+1)",n,t,r))},stop:function(i){throw i=i||"Unable to compute integral!",e.Utils.warn(i),new Q(i)},partial_fraction:function(r,n,a,o){var l,p;return t(n)||(n=i.parse(n)),l=new s(0),(p=e.Algebra.PartFrac.partfrac(r,n)).group===v&&p.isLinear()?p.each(function(e){l=i.add(l,K.integrate(e,n,a,o))}):l=i.add(l,K.integrate(p,n,a,o)),l},get_udv:function(r){var n=[[],[],[],[],[]],t=function(i){var r=i.group;if(r===a){var t=i.fname;e.Utils.in_trig(t)||e.Utils.in_htrig(t)?n[3].push(i):e.Utils.in_inverse_trig(t)?n[1].push(i):t===h?n[0].push(i):K.integration.stop()}else r===m||i.isComposite()&&i.isLinear()||r===v&&i.isLinear()?n[2].push(i):r===y||i.isComposite()&&!i.isLinear()?n[4].push(i):K.integration.stop()};r.group===v?r.each(function(e){t(s.unwrapSQRT(e,!0))}):t(r);for(var o,l=new s(1),p=0;p<5;p++){var u,c=n[p],f=c.length;if(f>0){if(f>1){u=new s(1);for(var g=0;g<f;g++)u=i.multiply(u,c[g].clone())}else u=c[0].clone();o?l=i.multiply(l,u):(o=u).multiplier=o.multiplier.multiply(r.multiplier)}}return[o,l]},trig_sub:function(r,n,t,a,s,o){(s=s||K.integration.decompose_arg(r.clone().toLinear(),n))[3],s[2];var p=s[0],u=s[1];if(u.power.equals(2)&&p.greaterThan(0)){var c=e.Utils.getU(r),f=i.parse(q+l(c)),g=i.parse(S+l(c)+"^2"),m=i.multiply(r.sub(u,f),g),w=K.integrate(m,c,t,a).sub(f,u);return e.Utils.clearU(f),w}},by_parts:function(r,n,t,a){var o,l,p,u,c,f,g,m,w,d,v,y;if(a.previous=a.previous||[],l=(o=K.integration.get_udv(r))[0],p=o[1],v=(u=s.unwrapSQRT(i.expand(K.diff(l.clone(),n)),!0)).clone().stripVar(n),u=i.divide(u,v.clone()),c=K.integrate(p.clone(),n,t||0),y=(f=i.multiply(c.clone(),u)).toString(),-1!==a.previous.indexOf(y)&&e.Utils.in_trig(l.fname)&&p.isE())return a.is_cyclic=!0,new s(1);if(a.previous.push(y),g=i.multiply(l,c),d=f.multiplier.clone(),f.toUnitMultiplier(),(w=i.multiply(K.integrate(f.clone(),n,t,a),v)).multiplier=w.multiplier.multiply(d),m=i.subtract(g,w),a.is_cyclic&&(a.previous.pop(),0===a.previous.length)){m=i.expand(m);var b=new s(0);m.each(function(e){e.contains(n)||(b=i.add(b,e.clone()))}),m=i.divide(i.subtract(m,b.clone()),i.subtract(new s(1),b))}return m},decompose_arg:e.Utils.decompose_fn},integrate:function(o,f,g,b){if(!f){var X=e.Utils.variables(o);1===X.length&&(f=X[0]),f=f||"x"}if(e.Utils.isVector(o)){var Z=new e.Vector([]);return o.each(function(e){Z.elements.push(K.integrate(e,f))}),Z}return isNaN(f)||i.error("variable expected but received "+f),o.isConstant(!0)?i.multiply(o.clone(),i.parse(f)):(b=b||{},e.Utils.block("PARSE2NUMBER",function(){g=g||0;var X,Z=t(f)?f.toString():f,z=s.unwrapSQRT(o.clone(),!0),W=z.group;try{if(++g>e.Settings.integration_depth&&K.integration.stop("Maximum depth reached. Exiting!"),z.contains(Z,!0)){if(W===m)X=K.integration.poly_integrate(z,Z,g);else if(W===y)if(z.previousGroup===a&&"sqrt"!==z.fname&&z.fname!==n.PARENTHESIS&&K.integration.stop(),z.contains(Z)&&z.previousGroup!==a){if(z.power.contains(Z))K.integration.stop();else(Je=K.diff(z.clone().toLinear(),Z)).contains(Z)&&K.integration.stop(),X=K.integration.poly_integrate(z,Z,g)}else{if((ae=K.diff(z.power.clone(),Z)).contains(Z)){var Y=ae.stripVar(Z);if((se=i.divide(ae.clone(),Y.clone())).group===m&&se.isLinear())return Y.multiplier=Y.multiplier.divide(new r(2)),i.parse(u("({2})*(sqrt(pi)*erf(sqrt(-{0})*{1}))/(2*sqrt(-{0}))",Y,Z,z.multiplier));K.integration.stop()}if(z.isE())ae.isLinear()?X=z:ae.isE()&&ae.power.group===m&&ae.power.power.equals(1)?X=i.multiply(i.symfunction("Ei",[z.power.clone()]),z.power):K.integration.stop();else{var $=i.symfunction(h,[i.parse(z.value)]);X=i.divide(z,$)}X=i.divide(X,ae)}else if(z.isComposite()&&z.isLinear()){var ee=i.parse(z.multiplier);z.toUnitMultiplier(),X=new s(0),z.each(function(e){X=i.add(X,K.integrate(e,Z,g))}),X=i.multiply(ee,X)}else if(W===d)if(z.power.greaterThan(1)&&(z=i.expand(z)),z.power.equals(1))X=new s(0),z.each(function(e){X=i.add(X,K.integrate(e,Z,g))},!0);else{var ie=Number(z.power);ee=z.multiplier.clone();z.toUnitMultiplier();var re=z.clone().toLinear(),ne=(Mi=K.integration.decompose_arg(re,Z))[3],te=Mi[2],ae=Mi[0],se=Mi[1];if(-1===ie&&se.group!==w&&se.power.equals(2)){var oe=!p(ne)||ne>0;if(se.group===m&&se.power.equals(2)&&oe){var le=function(e){var r=new s(1);return e.each(function(e){r=i.multiply(r,"abs"===e.fname?e.args[0]:e)}),r},pe=ae.clone(),ue=ne.clone();pe=i.pow(pe,new s(.5)),ue=i.pow(ue,new s(.5));$=i.multiply(le(ue),le(pe));var ce=i.symfunction(I,[i.divide(i.multiply(ae,se.toLinear()),$.clone())]);X=i.divide(ce,$)}else if(se.group===m&&se.isLinear())X=i.divide(K.integration.poly_integrate(z),ae);else if(se.power.equals(4)){var fe,ge,me,we,de,ve,ye=l;pe=i.parse(_+ye(ae)+"*"+Z+"^2"),ue=i.parse(_+ye(2)+"*"+ye(ae)+"^"+ye("1/4")+"*"+ye(ne)+"^"+ye("1/4")+"*"+Z),fe=i.parse(_+ye(ne)),Ie=i.add(i.add(pe.clone(),ue.clone()),fe.clone()),ei=i.add(i.subtract(pe,ue),fe),ge=i.parse(_+ye(2)+"*"+ye(ne)+"^"+ye("3/4")),me=i.parse(_+ye(ne)+"*"+ye(ne)+"^"+ye("1/4")+"*"+Z),we=i.parse("2*"+ye(ne)+"*"+_+ye(2)+"*"+ye(ne)+"^"+ye("1/4")),de=i.divide(i.subtract(ge.clone(),me.clone()),i.multiply(we.clone(),ei)),ve=i.divide(i.add(ge,me),i.multiply(we,Ie.clone())),X=i.add(K.integrate(de,Z,g,b),K.integrate(ve,Z,g,b))}else X=K.integration.partial_fraction(z,Z,g)}else if(-.5===ie)if(se.group===m&&se.power.equals(2))if(te.multiplier.lessThan(0)&&!ne.multiplier.lessThan(0))if(ae.negate(),ne.isConstant()&&ae.isConstant()){$=i.symfunction(_,[ae.clone()]);var be=i.symfunction(_,[i.multiply(ae.clone(),ne)]);X=i.divide(i.symfunction(C,[i.divide(te.toLinear(),be)]),$)}else{var he=i.symfunction(_,[ae]),Le=i.multiply(he.clone(),se.clone().toLinear());X=i.divide(i.symfunction(I,[i.divide(Le,i.symfunction(_,[re.clone()]))]),he)}else K.integration.stop();else K.integration.stop();else if(se.isLinear()&&se.group!==w)X=i.divide(K.integration.poly_integrate(z),ae);else{if(se.power.equals(2)&&ae.greaterThan(0)){var _e,Ue,ke,qe,Se,xe;_e=i.parse(_+l(ae)),Ue=i.parse(_+l(ne)),ke=i.multiply(_e.clone(),Ue.clone()).invert(),qe=i.pow(ne,new s(z.power)),xe=e.Utils.getU(z),Fe=i.multiply(ke,se.clone().toLinear()),Se=i.parse(I+l(Fe));var Te=2*(Math.abs(z.power)-1),Ce=K.integrate(i.parse(k+l(xe)+"^"+Te));return e.Utils.clearU(xe),i.multiply(Ce.sub(xe,Se),qe)}if(z.group===v||z.power.lessThan(0)){ce=z.clone().toLinear();var Ne=e.Algebra.Factor.factor(ce).toString()!==ce.toString();if(e.Algebra.degree(ce,i.parse(Z)).equals(2)&&!Ne)try{var Ie,Ae,Ee;Ee=e.Algebra.sqComplete(ce,Z),Fe=e.Utils.getU(ce),Ie=Ee.f.sub(Ee.a,Fe),Ae=i.pow(Ie,i.parse(z.power)),X=K.integrate(Ae,Fe).sub(Fe,Ee.a)}catch(e){K.integration.stop()}else X=K.integration.partial_fraction(z,Z,g,b)}else X=K.integration.by_parts(z,Z,g,b)}X.multiplier=X.multiplier.multiply(ee)}else if(W===a){var Me=z.args[0];ee=z.multiplier.clone();z.toUnitMultiplier();ae=(Mi=K.integration.decompose_arg(Me,Z))[0],se=Mi[1];var Oe=z.fname;if(Oe===h||Oe===C||Oe===N||Oe===I&&se.isLinear()){ie=z.power.toString();if(p(ie)&&(g-=ie),Me.isComposite()){var Fe=e.Utils.getU(z),Re=(ce=i.pow(i.parse(h+l(Fe)),new s(ie)),K.diff(Me,Z)),Ge=i.multiply(ce,Re);Ce=K.integrate(Ge,Fe,g,b);X=i.multiply(i.parse(ee),Ce.sub(Fe,Me))}else X=i.multiply(i.parse(ee),K.integration.by_parts(z,Z,g,b))}else{if(Oe===q&&z.power.lessThan(0))return(Qi=z.clone()).power.negate(),Qi.fname=T,i.multiply(i.parse(ee),K.integrate(Qi,Z,g));if(!ae.contains(Z,!0)&&z.isLinear())if(Oe===L){if((se=i.divide(Me.clone(),ae.clone())).group!==m||se.power.lessThan(0))K.integration.stop();else if(e.Utils.even(se.power))X=K.integrate(Me,Z,g);else{var De=K.integrate(se,Z,g);De.power=De.power.subtract(new r(1)),X=i.multiply(i.multiply(i.symfunction(L,[se.toLinear()]),De),ae)}}else{var Ve=z.args[0].group,Pe=K.integration.decompose_arg(Me,Z);switch((Ve!==d&&Ve!==m&&Ve!==v||!Pe[1].power.equals(1)||Me.hasFunc())&&K.integration.stop(),Oe){case k:X=i.symfunction(U,[Me]);break;case U:(X=i.symfunction(k,[Me])).negate();break;case q:X=i.parse(u(n.LOG+"(sec({0}))",Me));break;case S:X=i.parse(u(n.LOG+"(tan({0})+sec({0}))",Me));break;case x:X=i.parse(u("-"+n.LOG+"(csc({0})+cot({0}))",Me));break;case T:X=i.parse(u(n.LOG+"(sin({0}))",Me));break;case O:X=i.symfunction(F,[Me]);break;case F:X=i.symfunction(O,[Me]);break;case R:X=i.parse(u(n.LOG+"(cosh({0}))",Me));break;case A:case E:case M:case P:case B:case H:X=K.integration.by_parts(z,Z,g,b);break;case D:X=i.parse(u("atan(sinh({0}))",Me));break;case G:X=i.parse(u(n.LOG+"(tanh(({0})/2))",Me));break;case V:X=i.parse(u(n.LOG+"(sinh({0}))",Me));break;case"exp":X=K.integrate(i.parse(u("e^({0})",Me)),Z,g);break;case"S":Me=z.args[0].clone();var Be=(Vi=K.integration.decompose_arg(Me,Z))[1],He=Vi[0],Qe=Vi[3];X=i.parse(u("(cos((1/2)*pi*(({1})+({0})*({2}))^2)+pi*(({1})+({0})*({2}))*S(({1})+({0})*({2})))/(({0})*pi)",He,Qe,se));break;case"C":Me=z.args[0].clone(),Be=(Vi=K.integration.decompose_arg(Me,Z))[1],He=Vi[0],Qe=Vi[3];X=i.parse(u("(pi*(({1})+({0})*({2}))*C(({1})+({0})*({2}))-sin((1/2)*pi*(({1})+({0})*({2}))^2))/(({0})*pi)",He,Qe,Be));break;case"erf":Me=z.args[0].clone(),Be=(Vi=K.integration.decompose_arg(Me,Z))[1],He=Vi[0];X=i.parse(u("e^(-(({2}))^2)/(({0})*sqrt(pi))+(1/({0})+({1}))*erf(({2}))",He,Be,Me));break;case"sign":X=i.multiply(z.clone(),Me.clone());break;default:K.integration.stop()}X=i.divide(X,ae)}else if(se.isLinear()){if(Oe===k||Oe===U)if((ie=Number(z.power))<0)z.fname=Oe===U?x:S,z.invert().updateHash(),X=K.integrate(z,Z,g);else{Me=z.args[0];var je=z.clone(),Xe=z.clone(),Ze=new s((ie-1)/ie),ze=i.multiply(ae.clone(),new s(ie)).invert();je.power=je.power.subtract(new r(1)),Xe.power=Xe.power.subtract(new r(2));var Je=i.symfunction(Oe===k?U:k,[Me.clone()]);Oe===U&&Je.negate(),X=i.add(i.multiply(i.multiply(ze,je),Je),i.multiply(Ze,K.integrate(i.parse(Xe),Z,g)))}else if(Oe===q||Oe===T){if(z.args[0].isLinear(Z)){Te=z.power.subtract(new r(1)).toString();var Ke=z.clone().toUnitMultiplier(),We=i.parse(u((Oe===T?"-":"")+"1/({2}*{0})*{3}({1})^({0})",Te,Me,ae,Oe));Ke.power=Ke.power.subtract(new r(2)),Ke.power.equals(0)&&(Ke=i.parse(Ke)),X=i.subtract(We,K.integrate(Ke,Z,g))}}else if(Oe===S||Oe===x){var Ye=z.power.subtract(new r(1)).toString(),$e=z.power.subtract(new r(2)).toString(),ei=Oe===S?q:T,ii=(Ke=z.clone().toUnitMultiplier(),u((Oe===x?"-":"")+"1/({0}*{1})*{4}({3})^({2})*{5}({3})",ae,Ye,$e,Me,Oe,ei));We=i.parse(ii);Ke.power=Ke.power.subtract(new r(2)),Ke.power.equals(0)&&(Ke=i.parse(Ke)),X=i.add(We,i.multiply(new s($e/Ye),K.integrate(Ke,Z,g)))}else Oe!==F&&Oe!==O||!z.power.equals(2)?K.integration.stop():X=K.integrate(z.fnTransform(),Z,g)}else K.integration.stop();X.multiplier=X.multiplier.multiply(ee)}}else if(W===w)X=K.integration.partial_fraction(z,Z,g);else if(W===v){z.getDenom().group===m&&(z=i.expand(z));var ri=z.stripVar(Z),ni=i.divide(z.clone(),ri.clone());if(ri.contains(Z)&&(ni=i.multiply(ni,ri),ri=new s(1)),ni.group!==v){if(ni.equals(1))return K.integrate(i.expand(z),Z,g);ni.clone().toLinear().isPoly(!0)&&e.Utils.variables(ni).length>1&&(ni=e.Algebra.Factor.factor(ni)),X=K.integrate(ni,Z,g)}else{var ti=ni.collectSymbols().sort(function(e,i){return e.group===i.group?Number(e.power)===Number(i.power)?e<i?1:-1:i.power-e.power:i.group-e.group}).map(function(e){var r=s.unwrapSQRT(e,!0);return"exp"===r.fname?i.parse(u("({1})*e^({0})",r.args[0],r.multiplier)):r}),ai=ti.length;if(z.power<0){if(2===ai)return K.integrate(i.expand(z),Z,g,b)}else if(2===ai){try{X=K.integration.u_substitution(ti,Z)}catch(e){}if(!X){var si=ti[0].group,oi=ti[1].group,li=ti[0],pi=ti[1],ui=li.fname,ci=pi.fname;if(z=i.multiply(li.clone(),pi.clone()),si===a&&oi===a)if(ui===h||ci===h)X=K.integration.by_parts(z.clone(),Z,g,b);else{ti.sort(function(e,i){return i.fname>e.fname});var fi=li.args[0];(!fi.isLinear()||fi.group!==d&&fi.group!==v&&fi.group!==m)&&K.integration.stop(),se=(Mi=K.integration.decompose_arg(fi,Z))[1],ae=Mi[0],se.isLinear()||K.integration.stop();var gi=pi.args[0];if(fi.equals(gi))if(ui===U&&ci===k||ui===k&&ci===U)if(li.power.lessThan(0)&&K.integration.stop(),ui===U&&li.power.add(pi.power).equals(0))li.fname=q,li.updateHash(),X=K.integrate(li,Z,g);else if(c(li.power)&&ci===k&&pi.power.lessThan(0)){Te=Number(li.power)/2;var mi=i.parse(u("(1-cos({0})^2)^({1})",li.args[0],Te));X=K.integrate(i.expand(i.multiply(mi,pi.clone())),Z,g,b)}else if(c(li.power)&&ci===U&&pi.power.lessThan(0)){Te=Number(li.power)/2,mi=i.parse(u("(1-sin({0})^2)^({1})",li.args[0],Te));X=K.integrate(i.expand(i.multiply(mi,pi.clone())),Z,g,b)}else{var wi=e.Utils.even(li.power),di=e.Utils.even(pi.power);if(X=new s(0),wi&&di){var vi=function(e){var r,n=e.power/2;return r=e.fname===k?"((1/2)+(cos(2*("+e.args[0]+"))/2))^"+n:"((1/2)-(cos(2*("+e.args[0]+"))/2))^"+n,i.parse(r)};ae=vi(li),ne=vi(pi),Je=i.multiply(ae,ne);return(Qi=i.expand(Je)).each(function(e){X=i.add(X,K.integrate(e,Z,g))}),i.multiply(X,ri)}wi?(Fe=li,Ke=pi):(Fe=pi,Ke=li);var yi=Fe.fname===k?-1:1,bi=((Te=Ke.power)-1)/2,hi=i.parse("(1-"+Fe.fname+e.Utils.inBrackets(fi)+"^2)^"+bi);(Qi=i.expand(i.multiply(new s(yi),i.multiply(Fe.clone(),hi)))).each(function(e){X=i.add(X,K.integration.poly_integrate(e.clone()))})}else if(ui===S&&ci===q&&se.isLinear()&&pi.isLinear())X=i.parse(u("sec({0})^({1})/({1})",li.args[0],li.power));else if(ui===q&&ci===S&&se.isLinear())if(li.isLinear()&&pi.isLinear())X=i.divide(i.symfunction(S,[fi.clone()]),ae);else if(c(li.power)){ie=Number(li.power)/2,Je=i.parse(u("(sec({0})^2-1)^({1})",li.args[0],ie));X=K.integrate(i.expand(i.multiply(Je,pi)),Z,g)}else K.integration.stop();else if(ui===S&&ci===k)li.fname=k,li.invert().updateHash(),X=K.integrate(i.multiply(li,pi),Z,g);else if(ui===U&&ci===x)pi.fname=U,pi.invert().updateHash(),X=K.integrate(i.multiply(li,pi),Z,g);else if(ui!==q||ci!==k&&ci!==U||!pi.power.lessThan(0)){Je=i.multiply(li.fnTransform(),pi.fnTransform());X=K.integrate(i.expand(Je),Z,g)}else{var Je=i.multiply(li.fnTransform(),pi);X=K.integrate(i.expand(Je),Z,g)}else if(ui!==U&&ui!==k||ci!==U&&ci!==k)K.integration.stop();else{var Li=J(ti);X=K.integrate(i.expand(Li),Z,g)}}else if(si===a&&oi===m){var _i=li.isLinear();if(li.fname===k&&_i&&pi.power.equals(-1))X=i.symfunction("Ci",[li.args[0]]);else if(li.fname===k&&pi.power.equals(-1))X=K.integrate(i.multiply(li.fnTransform(),pi.clone()),Z,g);else if(li.fname===F&&_i&&pi.power.equals(-1))X=i.symfunction("Chi",[li.args[0]]);else if(li.fname===F&&pi.power.equals(-1))X=K.integrate(i.multiply(li.fnTransform(),pi.clone()),Z,g);else if(li.fname===U&&_i&&pi.power.equals(-1))X=i.symfunction("Si",[li.args[0]]);else if(li.fname===U&&pi.power.equals(-1))X=K.integrate(i.multiply(li.fnTransform(),pi.clone()),Z,g);else if(li.fname===O&&_i&&pi.power.equals(-1))X=i.symfunction("Shi",[li.args[0]]);else if(li.fname===O&&pi.power.equals(-1))X=K.integrate(i.multiply(li.fnTransform(),pi.clone()),Z,g);else if(li.fname===h&&pi.power.equals(-1))X=K.integration.poly_integrate(li,Z,g);else if("erf"===li.fname){if(pi.power.equals(1)){He=(Vi=K.integration.decompose_arg(li.args[0],Z))[0],Be=Vi[1],Me=li.args[0].toString();X=i.parse(u("(e^(-(({2}))^2)*(sqrt(pi)*e^((({2}))^2)*(2*({0})^2*({1})^2-3)*erf(({2}))+2*({0})*({1})-2))/(4*sqrt(pi)*({0})^2)",He,Be,Me))}}else X=K.integration.by_parts(z,Z,g,b)}else if(si===y&&oi===m){se=ui===h?K.integration.decompose_arg(li.args[0],Z)[1]:null;X=li.isE()&&(li.power.group===m||li.power.group===v)&&pi.power.equals(-1)?i.symfunction("Ei",[li.power.clone()]):ui===h&&se.value===pi.value?K.integration.poly_integrate(li,Z,g):K.integration.by_parts(z,Z,g,b)}else if(si===w&&oi===m){if(pi.value===li.value&&li.power.equals(-1)){var Ui=Math.min.apply(null,e.Utils.keys(li.symbols)),ki=Math.min(Ui,pi.power),qi=pi.clone();qi.power=new r(ki),pi=i.divide(pi,qi.clone());Je=new s(0);li.each(function(e){Je=i.add(Je,i.divide(e.clone(),qi.clone()))}),Je.multiplier=li.multiplier,z=i.divide(pi,Je)}X=K.integration.partial_fraction(z,Z,g)}else if(si===d&&oi===m){ce=li.clone().toLinear();var Si=e.Algebra.degree(ce,i.parse(Z)).equals(1);if(li.power.equals(-.5)){ae=(Mi=K.integration.decompose_arg(li.clone().toLinear(),Z))[0].negate(),se=Mi[1],ne=Mi[3];var xi=Number(li.power),Ti=Number(pi.power);if(p(Ti)&&e.Utils.even(Ti)&&se.power.equals(2)){var Ci=i.divide(i.multiply(i.pow(ne.clone(),new s(2)),i.symfunction(_,[i.divide(ne.clone(),ae.clone())])),i.pow(ae.clone(),new s(2)));Ci=i.multiply(Ci,i.symfunction(_,[ne]).invert());var Ni=i.parse("sin(u)");Ni.power=Ni.power.multiply(pi.power);Ce=K.integrate(Ni,"u",g);var Ii=i.parse(C+"("+_+"("+ae+"/"+ne+")*"+Z+")");X=i.multiply(Ci,Ce.sub(new s("u"),Ii))}else if(-.5===xi){var Ai=function(e,r){var n=i.parse(K.integrate(e,Z,g,b).sub(Z,u(r,Z)));if(!n.hasIntegral())return n};-1===Ti?X=Ai(i.expand(i.expand(i.pow(i.multiply(li.invert(),pi.invert()),new s(2)))).invert(),"sqrt(1-1/({0})^2)"):-2===Ti&&(X=Ai(i.sqrt(i.expand(i.divide(i.pow(z,new s(2)).invert(),i.pow(new s(Z),new s(2))).negate())).invert(),"sqrt(1-1/({0})^2)"))}}else if(li.power.equals(-1)&&pi.isLinear()&&Si)X=K.integration.partial_fraction(z,Z,g);else if(!li.power.lessThan(0)&&p(li.power)){var Ei=i.expand(li);X=new s(0),Ei.each(function(e){e.group===w?e.each(function(e){X=i.add(X,K.integrate(i.multiply(pi.clone(),e),Z,g))}):X=i.add(X,K.integrate(i.multiply(pi.clone(),e),Z,g))})}else if(li.power.lessThan(-2))X=K.integration.by_parts(z,Z,g,b);else if(li.power.lessThan(0)&&pi.power.greaterThan(1)){var Mi;ae=(Mi=K.integration.decompose_arg(li.clone().toLinear(),Z))[0].negate(),se=Mi[1],ne=Mi[3],re=li.clone().toLinear();if(se.group!==w&&se.isLinear()){ie=Number(pi.power),Fe=new s(Re="_u_");var Oi=i.expand(i.divide(i.pow(i.subtract(Fe.clone(),ne.clone()),new s(ie)),Fe.clone())),Fi={};Fi[Re]=re;var Ri=i.parse(Oi,Fi);X=K.integrate(Ri,Z,0)}else if(pi.power.greaterThan(se.power)||pi.power.equals(se.power)){var Gi=new e.Algebra.Classes.Factors;li=e.Algebra.Factor.coeffFactor(li.invert(),Gi);var Di=e.Algebra.divide(pi,li);Di.group!==v?(X=new s(0),Di.each(function(e){X=i.add(X,K.integrate(e,Z,g))}),Gi.each(function(e){X=i.divide(X,e)}),X=i.expand(X)):X=K.integration.by_parts(z,Z,g,b)}else X=K.integration.partial_fraction(z,Z,g)}else if(li.power.den.equals(2)){var Vi;ae=(Vi=K.integration.decompose_arg(li.clone().toLinear(),Z))[3],se=Vi[1],ne=Vi[0],Vi[2];if(se.power.equals(2)&&ne.lessThan(0)){ae.equals(1)||(ri=i.multiply(ri,i.pow(ae,new s(2))));Fe=Z,Ci=i.divide(i.pow(ne.clone().negate(),new s(.5)),i.pow(ae,new s(.5))),Re=i.symfunction(k,[new s(Fe)]);var Pi=i.pow(i.symfunction(k,[new s(Fe)]),new s(li.power.num)),Bi=i.pow(i.symfunction(U,[new s(Fe)]),new s(pi.power)),Hi=i.multiply(i.multiply(Pi,Re),Bi);Ce=K.integrate(Hi,Fe,g);X=Ce.sub(Fe,i.symfunction(C,[i.multiply(new s(Z),Ci)]))}else X=K.integration.partial_fraction(z,Z,g,b)}else Si&&(X=K.integration.partial_fraction(z,Z,g))}else if(li.isComposite()&&pi.isComposite())if(X=new s(0),li.power.greaterThan(0)&&pi.power.greaterThan(0)){var Qi;(Qi=i.expand(z)).each(function(e){X=i.add(X,K.integrate(e,Z,g))},!0)}else{xi=Number(li.power),Ti=Number(pi.power);if(xi<0&&Ti>0){Je=li;li=pi,pi=Je}-1===xi&&-1===Ti?X=K.integration.partial_fraction(z,Z):li.each(function(e){var r=i.multiply(e,pi.clone()),n=K.integrate(r,Z,g);X=i.add(X,n)})}else if(si===d&&ti[0].power.greaterThan(0))li=i.expand(li),X=new s(0),li.each(function(e){X=i.add(X,K.integrate(i.multiply(e,pi.clone()),Z,g))},!0);else if(si===a&&oi===y&&e.Utils.in_htrig(li.fname))li=li.fnTransform(),X=K.integrate(i.expand(i.multiply(li,pi)),Z,g);else if(si===a&&oi===d||oi===a&&si===d){if(oi===a&&si===d){Je=li;li=pi,pi=Je}var ji,Xi,Zi;if(Re=s.unwrapSQRT(K.diff(li.clone(),Z),!0),ji=s.unwrapSQRT(pi,!0),Re.power.equals(ji.power)){if(ie=new s(pi.power),Xi=Re.clone().toLinear(),Zi=pi.clone().toLinear(),(Ze=e.Algebra.divide(Xi.toLinear(),Zi)).isConstant()){var zi=i.pow(Ze,ie.negate());X=i.multiply(zi,K.integration.poly_integrate(li.clone()))}}else X=K.integration.by_parts(z,Z,g,b)}else{var Ji=li.clone().toLinear(),Ki=pi.clone().toLinear();X=si===y&&oi===y&&li.power.contains(Z)&&pi.power.contains(Z)&&!Ji.contains(Z)&&!Ki.contains(Z)?i.parse(u("(({0})^(({2})*({4}))*({1})^(({3})*({4})))/(log(({0})^({2}))+log(({1})^({3})))",Ji.toString(),Ki.toString(),li.power.multiplier.toString(),pi.power.multiplier.toString(),Z)):K.integration.by_parts(z,Z,g,b)}}}else if(3===ai&&(ti[2].group===m&&ti[2].power.lessThan(2)||ti[0].group===d)){var Wi=ti[0];if(Wi.group===d){Wi.power.greaterThan(1)&&(Wi=i.expand(Wi));Ke=i.multiply(ti[1],ti[2]);X=new s(0),Wi.each(function(e){var r=i.multiply(e,Ke.clone()),n=K.integrate(r,Z,g);X=i.add(X,n)},!0)}else X=K.integration.by_parts(z,Z,g,b)}else if(j(ti)){Je=new s(1);var Yi=0;for(ai=ti.length;Yi<ai;Yi++)Je=i.multiply(Je,ti[Yi].fnTransform());Je=i.expand(Je),X=K.integrate(Je,Z,g)}else{Li=J(ti);X=K.integrate(i.expand(Li),Z,g)}}X=i.multiply(X,ri)}}else X=i.multiply(z.clone(),i.parse(Z));if(X)return X}catch(i){if(!(i instanceof Q||i instanceof e.exceptions.DivisionByZero))throw i}return i.symfunction("integrate",[o,f])},!1))},defint:function(r,n,t,a){a=a||"x";var o,l=function(e,r,n){try{return i.parse(e,r)}catch(i){return K.Limit.limit(e,a,n)}},p=e.Utils.variables(r),u=K.integrate(r,a);if(1===p.length&&(a=p[0]),u.hasIntegral())if(1===p.length&&n.isConstant()&&t.isConstant()){var c=e.Utils.build(r);o=new s(e.Math2.num_integrate(c,Number(n),Number(t)))}else o=i.symfunction("defint",[r,n,t,a]);else{var f,g,m={},w={};m[a]=t,w[a]=n,f=l(u,m,t),g=l(u,w,n),o=i.subtract(f,g)}return o},Limit:{interval:function(e,r){return i.parse(u("[{0}, {1}]",e,r))},diverges:function(){return K.Limit.interval("-Infinity","Infinity")},divide:function(r,n,t,a){r.clone(),n.clone();var o=function(i){if(e.Utils.isVector(i)){for(var r=0;r<i.elements.length;r++)if(!i.elements[r].isInfinity)return!1;return!0}return i.isInfinity},l=function(i,r){return!e.Utils.isVector(i)&&i.equals(r)};do{var p=f(K.Limit.limit(r,t,a)),u=f(K.Limit.limit(n,t,a)),c=o(p)&&o(u)||l(p,0)&&l(u,0);if(c){var g=K.diff(r.clone(),t),m=K.diff(n.clone(),t),w=i.expand(i.divide(g,m));r=w.getNum(),n=w.getDenom()}}while(c);return p.isInfinity&&u.equals(0)?p:p.equals(0)&&u.isInfinity?p:p.isInfinity?p:u.isInfinity?new s(0):u.equals(0)?K.Limit.diverges():i.divide(p,u)},rewriteToLog:function(e){var r=e.power.clone();return e.toLinear(),i.pow(new s("e"),i.multiply(r,i.symfunction(n.LOG+"",[e])))},getSubbed:function(e,i,r){var n;e.group===y&&(e=K.rewriteToLog(e));try{n=e.sub(i,r)}catch(i){n=e}return n},isInterval:function(i){return e.Utils.isVector(i)},isConvergent:function(e){return!(K.Limit.isInterval(e)&&e.elements[0].isInfinity&&e.elements[1].isInfinity||e.containsFunction("limit"))},limit:function(r,t,o){var l=i.parse(r.multiplier);r.toUnitMultiplier();try{var p;if(r.isConstant(!0))p=r;else{var c={};c[t]=o;try{var g=i.parse(r.sub(t,o),c);(g.isConstant(!0)||g.isInfinity)&&(p=g)}catch(e){}if(!p){var w=r.getNum(),d=r.getDenom();if(d.isConstant(!0)){if(r.group===y){var b=r.clone().toLinear(),L=(r.power.clone(),b.getNum()),_=b.getDenom(),S=e.Utils.decompose_fn(_,t,!0);if(L.group===m&&L.multiplier.isOne()&&S.ax.group===m&&S.b.isConstant(!0)&&S.a.isOne()&&S.b.isConstant(!0))p=i.parse(u("(1/e^({0}))",S.b));else{var x=K.Limit.rewriteToLog(r.clone()),T=x.power.clone(),C=x.clone().toLinear(),N=K.Limit.limit(C,t,o),I=K.Limit.limit(T,t,o);p=i.pow(N,I)}}else if(r.group===a&&1===r.args.length){var A=K.Limit.limit(r.args[0],t,o);if(e.Utils.isVector(A))return p=A.map(function(e){return r.clone().args[0]=e,K.Limit.limit(i.symfunction(r.fname,[e]),t,o)}),i.multiply(l,p);if(A.isConstant(!0)){var E,M=i.symfunction(r.fname,[A]);try{f(M),E=!0}catch(e){E=!1}}if(E)p=M;else if(K.Limit.isConvergent(A))if(r.fname===h)switch(A.toString()){case"0":p=s.infinity().negate();break;case"Infinity":case"-Infinity":p=s.infinity()}else if(r.fname!==k&&r.fname!==U||!o.isInfinity){if(r.fname===q){var O=r.args[0],F=O.getNum(),R=O.getDenom(),G=F.toUnitMultiplier();(o.isInfinity||G.equals("pi")&&R.equals(2))&&(p=divergent())}else if(r.fname===n.FACTORIAL&&A.isInfinity)return s.infinity()}else p=K.Limit.interval(-1,1)}else if(r.group===m){if(r.power>0)return i.parse(r,c);p=e.Utils.even(r.power)?s.infinity():K.Limit.diverges()}else if(r.group===v)if((r=i.expand(r)).group!==v)p=K.Limit.limit(r,t,o);else{var D,V,P=r.collectSymbols().sort(function(e,i){return e.group-i.group});b=P.pop();for(D=f(K.Limit.limit(b,t,o));P.length;){var B=P.pop();V=f(K.Limit.limit(B,t,o)),D.isInfinity||!K.Limit.isConvergent(D)&&V.equals(0)||D.equals(0)&&K.Limit.isConvergent(V)?(B.invert(),D=K.Limit.divide(b,B,t,o)):(D=i.multiply(D,V),b=i.multiply(b,B))}p=D}else if(r.isComposite()){var H,Q=r.clone();r.isLinear()||(r=i.expand(r)),p=new s(0),r.each(function(n){try{H=K.Limit.limit(n,t,o)}catch(e){H=K.Limit.diverges()}try{p=i.add(p,H)}catch(i){r=e.Utils.toCommonDenominator(Q),p=K.Limit.limit(r,t,o)}})}}else p=K.Limit.divide(w,d,t,o)}}p||(p=i.symfunction("limit",arguments))}catch(e){p=i.symfunction("limit",arguments)}return i.multiply(l,p)}},Fresnel:{S:function(e){return e.isConstant(!0)?K.defint(i.parse("sin(pi*x^2/2)"),s(0),e,"x"):i.symfunction("S",arguments)},C:function(e){return e.isConstant(!0)?K.defint(i.parse("cos(pi*x^2/2)"),s(0),e,"x"):i.symfunction("C",arguments)}}};nerdamer.register([{name:"diff",visible:!0,numargs:[1,3],build:function(){return K.diff}},{name:"sum",visible:!0,numargs:4,build:function(){return K.sum}},{name:"product",visible:!0,numargs:4,build:function(){return K.product}},{name:"integrate",visible:!0,numargs:[1,2],build:function(){return K.integrate}},{name:"defint",visible:!0,numargs:[3,4],build:function(){return K.defint}},{name:"S",visible:!0,numargs:1,build:function(){return K.Fresnel.S}},{name:"C",visible:!0,numargs:1,build:function(){return K.Fresnel.C}},{name:"limit",visible:!0,numargs:[3,4],build:function(){return K.Limit.limit}}]),nerdamer.api()}();